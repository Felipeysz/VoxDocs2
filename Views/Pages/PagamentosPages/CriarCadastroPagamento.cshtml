@model VoxDocs.Models.CriarCadastroPagamentoViewModel
@{
    Layout = null;
}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Cadastro • VoxDocs</title>
    <meta name="description" content="Finalize seu cadastro e pagamento para acessar a plataforma VoxDocs" />

    <!-- Fonts e Ícones -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    
    <!-- CSS otimizado -->
    <style>
    :root {
        --clr-primary: #5c3c8a;
        --clr-primary-dark: #4a3070;
        --clr-bg: #fafafa;
        --clr-card: #ffffff;
    }

    body {
        background-color: var(--clr-bg);
        font-family: 'Poppins', sans-serif;
    }

    .doc-card {
        background: var(--clr-card);
        border-radius: 12px;
        box-shadow: 0 4px 16px rgba(0,0,0,0.05);
        max-width: 480px;
    }

    .btn-primary {
        background-color: var(--clr-primary);
        border-color: var(--clr-primary);
    }

    .btn-primary:hover {
        background-color: var(--clr-primary-dark);
        border-color: var(--clr-primary-dark);
    }

    /* Stepper ajustado */
    .stepper-container {
        position: relative;
        margin: 2rem 0;
    }
    
    .stepper-line {
        position: absolute;
        top: 50%;
        left: 0;
        right: 0;
        height: 2px;
        background-color: #e0e0e0;
        z-index: 1;
        transform: translateY(-50%);
    }
    
    .stepper-line-progress {
        position: absolute;
        top: 50%;
        left: 0;
        height: 2px;
        background-color: var(--clr-primary);
        z-index: 2;
        transform: translateY(-50%);
        transition: width 0.3s ease;
    }
    
    .steps {
        display: flex;
        justify-content: space-between;
        position: relative;
        z-index: 3;
    }
    
    .step {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background-color: white;
        border: 2px solid #e0e0e0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: #999;
        transition: all 0.3s ease;
    }
    
    .step.active {
        border-color: var(--clr-primary);
        background-color: var(--clr-primary);
        color: white;
    }
    
    .step.completed {
        border-color: var(--clr-primary);
        color: var(--clr-primary);
    }
</style>
</head>
<body class="d-flex align-items-center justify-content-center min-vh-100 p-3">
<div class="doc-card shadow-lg p-4 w-100">
    <!-- Header -->
    <header class="mb-3 text-primary">
        <h1><i class="fas fa-user-plus me-2"></i>Cadastro de Empresa</h1>
    </header>

    <!-- Plano Info -->
    <div class="alert alert-info mb-3">
        Plano: <strong>@Model.NomePlano</strong> | Limite de usuários: <strong>@Model.LimiteUsuarios</strong>
    </div>

    <!-- Stepper -->
    <div class="stepper-container">
    <div class="stepper-line"></div>
    <div class="stepper-line-progress" style="width: 0%;"></div>
    <div class="steps">
            @for (int i = 1; i <= 5; i++) {
                <div class="step @(i == 1 ? "active" : "")">@i</div>
            }
        </div>
    </div>

    <!-- Form -->
    <form id="formWizard" asp-action="ConfirmarPagamento" method="POST">
        @Html.AntiForgeryToken()
        <input type="hidden" asp-for="Token" />
        <input type="hidden" asp-for="NomePlano"/>
        <input type="hidden" asp-for="Periodicidade" />

        <!-- STEP 1: Dados da Empresa -->
        <div class="step-content d-block" data-step="1">
            <div class="mb-3">
                <label asp-for="EmpresaContratante" class="form-label">Nome da Empresa</label>
                <input type="text" asp-for="EmpresaContratante" class="form-control" required />
            </div>
            <div class="mb-3">
                <label asp-for="EmailContato" class="form-label">E-mail da Empresa</label>
                <input type="email" asp-for="EmailContato" class="form-control" required />
                <small id="emailError" class="d-none text-danger"></small>
            </div>
            <div id="step1Error" class="d-none text-danger mb-3"></div>
        </div>

        <!-- STEP 2: Pastas -->
        <div class="step-content d-none" data-step="2">
            <div id="pastasPrincipaisContainer">
                @foreach (var pasta in Model.PastasPrincipais ?? new List<PastaPrincipalViewModel>()) {
                    <div class="card mb-3">
                        <div class="card-header">
                            <input type="text" value="@pasta.NomePastaPrincipal" class="form-control" placeholder="Nome da Pasta" required>
                        </div>
                        <div class="card-body">
                            @foreach (var subpasta in Model.SubPastas?.Where(s => s.NomePastaPrincipal == pasta.NomePastaPrincipal) ?? new List<SubPastaViewModel>()) {
                                <input type="text" value="@subpasta.NomeSubPasta" class="form-control mb-2" placeholder="Subpasta" required>
                            }
                            <button type="button" class="btn btn-sm btn-outline-secondary">+ Subpasta</button>
                        </div>
                    </div>
                }
            </div>
            <button type="button" id="btnAdicionarPastaPrincipal" class="btn btn-outline-primary">+ Pasta Principal</button>
        </div>

        <template id="templatePastaPrincipal">
            <div class="card mb-3">
                <div class="card-header">
                    <input type="text" class="form-control pasta-nome" placeholder="Nome da Pasta" required>
                </div>
                <div class="card-body subpastas-container">
                    <!-- Subpastas serão adicionadas aqui -->
                </div>
                <div class="card-footer">
                    <button type="button" class="btn btn-sm btn-outline-secondary btn-adicionar-subpasta">+ Subpasta</button>
                </div>
            </div>
        </template>

        <template id="templateSubpasta">
            <input type="text" class="form-control mb-2" placeholder="Subpasta" required>
        </template>

        <!-- STEP 3: Administradores -->
        <div class="step-content d-none" data-step="3">
            <div id="adminsContainer">
                @foreach (var admin in Model.Usuarios?.Where(u => u.PermissaoConta == "Admin") ?? new List<UsuarioViewModel>()) {
                    <div class="card mb-3 admin-card">
                        <div class="card-body">
                            <input type="text" value="@admin.Usuario" class="form-control mb-2" placeholder="Login" required data-field="Usuario">
                            <input type="email" value="@admin.Email" class="form-control mb-2" placeholder="E-mail" required data-field="Email">
                            <input type="password" value="@admin.Senha" class="form-control mb-2" placeholder="Senha" required data-field="Senha">
                            <button type="button" class="btn btn-sm btn-outline-danger remover-admin">Remover</button>
                        </div>
                    </div>
                }
            </div>
            <button type="button" id="btnAdicionarAdmin" class="btn btn-primary">+ Administrador</button>
            <div id="adminCount" class="mt-2"></div>
        </div>

        <template id="templateAdmin">
            <div class="card mb-3 admin-card">
                <div class="card-body">
                    <input type="text" class="form-control mb-2" placeholder="Login" required data-field="Usuario">
                    <input type="email" class="form-control mb-2" placeholder="E-mail" required data-field="Email">
                    <input type="password" class="form-control mb-2" placeholder="Senha" required data-field="Senha">
                    <button type="button" class="btn btn-sm btn-outline-danger remover-admin">Remover</button>
                </div>
            </div>
        </template>

        <!-- STEP 4: Usuários Comuns -->
        <div class="step-content d-none" data-step="4">
            <div id="usersContainer">
                @foreach (var user in Model.Usuarios?.Where(u => u.PermissaoConta == "User") ?? new List<UsuarioViewModel>()) {
                    <div class="card mb-3 user-card">
                        <div class="card-body">
                            <input type="text" value="@user.Usuario" class="form-control mb-2" placeholder="Login" required data-field="Usuario">
                            <input type="email" value="@user.Email" class="form-control mb-2" placeholder="E-mail" required data-field="Email">
                            <input type="password" value="@user.Senha" class="form-control mb-2" placeholder="Senha" required data-field="Senha">
                            <button type="button" class="btn btn-sm btn-outline-danger remover-user">Remover</button>
                        </div>
                    </div>
                }
            </div>
            <button type="button" id="btnAdicionarUser" class="btn btn-primary">+ Usuário</button>
            <div id="userCount" class="mt-2"></div>
        </div>

        <template id="templateUser">
            <div class="card mb-3 user-card">
                <div class="card-body">
                    <input type="text" class="form-control mb-2" placeholder="Login" required data-field="Usuario">
                    <input type="email" class="form-control mb-2" placeholder="E-mail" required data-field="Email">
                    <input type="password" class="form-control mb-2" placeholder="Senha" required data-field="Senha">
                    <button type="button" class="btn btn-sm btn-outline-danger remover-user">Remover</button>
                </div>
            </div>
        </template>

        <!-- STEP 5: Pagamento -->
        <div class="step-content d-none" data-step="5">
            <div class="mb-3">
                <label asp-for="MetodoPagamentoSelecionado" class="form-label">Método de Pagamento</label>
                <select asp-for="MetodoPagamentoSelecionado" class="form-select" required>
                    <option value="">Selecione...</option>
                    <option value="PIX">PIX</option>
                    <option value="CARTAO">Cartão de Crédito</option>
                    <option value="BOLETO">Boleto Bancário</option>
                </select>
            </div>
            <div id="cartaoCreditoFields" class="d-none">
                <div class="mb-3">
                    <label class="form-label">Número do Cartão</label>
                    <input type="text" class="form-control" placeholder="1234 5678 9012 3456" required>
                </div>
                <div class="mb-3">
                    <label class="form-label">Validade</label>
                    <input type="text" class="form-control" placeholder="MM/AA" required>
                </div>
                <div class="mb-3">
                    <label class="form-label">Código de Segurança</label>
                    <input type="text" class="form-control" placeholder="123" required>
                </div>
            </div>
            <button type="submit" class="btn btn-primary btn-lg w-100">Finalizar Pagamento</button>
        </div>

        <!-- Navegação -->
        <div class="d-flex justify-content-between mt-4">
            <button type="button" class="btn btn-outline-secondary" id="prevBtn" disabled>« Anterior</button>
            <button type="button" class="btn btn-primary" id="nextBtn">Próximo »</button>
        </div>
    </form>
</div>

<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script type="module" src="/js/PagamentoScript/ultilities.js"></script>
<script type="module" src="/js/PagamentoScript/main.js"></script>
</body>
</html>